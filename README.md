# Configuración de la Agencia Web

Este proyecto utiliza **React** (Frontend), **Supabase** (Base de datos y Autenticación) y **Cloudinary** (Almacenamiento de imágenes).

## 1. Configuración de Supabase

### A. Crear la Tabla (Inicial)
Ve al **SQL Editor** en tu panel de Supabase y ejecuta el siguiente script para crear la tabla necesaria (si no la tienes):

```sql
create table if not exists posts (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  title text not null,
  summary text,
  content text not null,
  image_url text,
  slug text
);
```

### B. Configurar Autenticación (Login)
1. Ve a **Authentication** -> **Providers**.
2. Asegúrate de que **Email** esté habilitado.
3. Ve a **Authentication** -> **Users** y crea un nuevo usuario (este será tu admin).

### C. LLAVE MAESTRA: Configurar Permisos (SOLUCIÓN DEFINITIVA A ERRORES DE BORRADO)
**IMPORTANTE:** Copia y pega este script exacto en el **SQL Editor** y ejecútalo. Esto borrará cualquier regla vieja que esté bloqueando tus acciones y creará una regla de "Admin Supremo".

```sql
-- 1. Habilitar seguridad
ALTER TABLE posts ENABLE ROW LEVEL SECURITY;

-- 2. BORRAR TODAS LAS REGLAS VIEJAS (Para evitar errores "policy already exists")
DROP POLICY IF EXISTS "Public posts are viewable by everyone" ON posts;
DROP POLICY IF EXISTS "Authenticated users can manage posts" ON posts;
DROP POLICY IF EXISTS "Enable read access for all users" ON posts;
DROP POLICY IF EXISTS "Enable insert for authenticated users only" ON posts;
DROP POLICY IF EXISTS "Enable update for authenticated users only" ON posts;
DROP POLICY IF EXISTS "Enable delete for authenticated users only" ON posts;
DROP POLICY IF EXISTS "Allow public read access" ON posts;
DROP POLICY IF EXISTS "Allow admin full access" ON posts;

-- 3. REGLA 1: TODO EL MUNDO (ANON) PUEDE LEER
CREATE POLICY "Allow public read access"
ON posts FOR SELECT
TO anon, authenticated
USING (true);

-- 4. REGLA 2: ADMIN (AUTENTICADO) PUEDE HACER TODO (BORRAR, EDITAR, CREAR)
-- Esta es la clave para que funcione el borrado
CREATE POLICY "Allow admin full access"
ON posts FOR ALL
TO authenticated
USING (true)
WITH CHECK (true);
```

### D. URLs AMIGABLES (SLUGS)
Si te falta la columna slug o quieres regenerarlos:

```sql
-- Asegurar que la columna existe
ALTER TABLE posts ADD COLUMN IF NOT EXISTS slug text;

-- Hacer el slug único
ALTER TABLE posts DROP CONSTRAINT IF EXISTS posts_slug_key;
ALTER TABLE posts ADD CONSTRAINT posts_slug_key UNIQUE (slug);
```

## 2. Configuración de Cloudinary

El sistema utiliza una carga "sin firmar" (Unsigned).
1. Ve a tu panel de Cloudinary -> **Settings** -> **Upload**.
2. En **Upload presets**, añade uno nuevo.
3. **IMPORTANTE:** En "Signing Mode", selecciona **Unsigned**.
4. En "Upload preset name", escribe: `blog_upload`.
